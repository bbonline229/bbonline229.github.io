{"title":"[iOS] Grand Central Dispatch - Part 1","date":"2019-09-20T02:45:24.000Z","link":"2019/09/20/grand-central-dispatch-part1","comments":true,"tags":["iOS"],"updated":"2019-10-07T08:59:56.938Z","content":"<p>ä¸»ç®¡ : æä»€éº¼, APP ç‚ºä»€éº¼é€²é¦–é å¡ä½äº† ï¼Ÿ<br>èœé³¥ : æˆ‘å‰›åœ¨é¦–é å¯«äº†ä¸‹è¼‰åœ–ç‰‡çš„åŠŸèƒ½, éä¸ä¹…åœ–ç‰‡å°±æœƒå‡ºç¾äº†<br>ä¸»ç®¡ : é‚£ä½ æœ‰åœ¨èƒŒæ™¯ä¸‹è¼‰å— ï¼Ÿ GCD ä¸æ˜¯å¯ä»¥æŠŠé•·æ™‚é–“çš„å·¥ä½œä¸Ÿåˆ°èƒŒæ™¯åŸ·è¡Œ<br>èœé³¥ : ä½ æ˜¯èªªæœ€å¤§å…¬å› æ•¸(GCD) å—ï¼Ÿ æˆ‘å°æ™‚å€™å¯æ˜¯æ•¸å­¸å¤©æ‰å‘¢<br>ä¸»ç®¡ : â€¦â€¦â€¦â€¦â€¦â€¦<br>èœé³¥ : æˆ‘æŠŠå®ƒä¸Ÿåˆ°èƒŒæ™¯å»ä¸‹è¼‰äº†, ä½†ç‚ºå•¥åœ–ç‰‡ä¸‹è¼‰å®Œäº†é¡¯ç¤ºä¸å‡ºä¾†<br>ä¸»ç®¡ : åœ–ç‰‡ä¸‹è¼‰å®Œ, æ›´æ–° UI è¦åœ¨ Main Thread å•¦ (ëˆˆ_ëˆˆ)<br>èœé³¥ : å¤©é˜¿ ~ å¯« APP å¥½é›£ QQ</p>\n<br>\n\n<p>æ—¥å¸¸é–‹ç™¼ iOS APP, æœƒé‡åˆ°éœ€è¦ä½¿ç”¨ GCD çš„æ™‚æ©Ÿå¾ˆå¤š<br>æœ€å¸¸æ‡‰ç”¨çš„å ´æ™¯æ‡‰è©²æ˜¯ç¶²è·¯è«‹æ±‚å§<br>GCD å°ä¸€å€‹åˆå­¸è€…ä¾†èªª, çœŸæ˜¯å€‹è¶…ç´šå¤§é­”ç‹é˜¿<br>é€™å¹¾ç¯‡æ–‡ç« å°±ä¾†ç°¡å–®ä»‹ç´¹ä¸€ä¸‹ GCD çš„ä¸€äº›åŸºç¤è§€å¿µ</p>\n<p><strong>- - - - - - - - - - - - - -</strong></p>\n<br>\n\n<h1 id=\"ä»€éº¼æ˜¯-GCD\"><u> <strong>ä»€éº¼æ˜¯ GCD ?</strong> </u><a href=\"2019/09/20/grand-central-dispatch-part1#ä»€éº¼æ˜¯-GCD\"></a></h1><p>ç°¡å–®ä¾†èªª GCD æ•´å€‹ç²¾é«“å°±æ˜¯å¯ä»¥è®“æˆ‘å€‘åŒä¸€æ™‚é–“èƒ½åšå¾ˆå¤šä»»å‹™ (Task), æˆ‘å€‘ç¨±ä¹‹ç‚º <strong>Concurrency</strong><br>GCD ä¹Ÿè®“é–‹ç™¼è€…ä¸ç”¨è·Ÿåº•å±¤æŠ€è¡“æ‰“äº¤é“, ä¾‹å¦‚æˆ‘å€‘ä¸ç”¨çŸ¥é“æ€éº¼æ“ä½œ Thread<br>ç•¶æˆ‘å€‘æäº¤ä»»å‹™æ™‚, Thread pool å»é¸é©ç•¶çš„ Thread</p>\n<p>GCD æ˜¯ Apple æä¾›çš„ä¸€å¥— Library</p>\n<p><mark> é–‹ç™¼è€…ä¸»è¦åšçš„äº‹ï¼š Create a queue, submit a task </mark></p>\n<h3 id=\"Task\">Task<a href=\"2019/09/20/grand-central-dispatch-part1#Task\"></a></h3><p>è¦è¢«åŸ·è¡Œçš„ä»»å‹™, ä¾‹å¦‚(ä¸‹è¼‰åœ–ç‰‡ã€Call API)<br>Task çµ„æˆå¯ä»¥æ˜¯ <code>WorkItem</code> æˆ–æ˜¯ <code>Closure</code></p>\n<li>WorkItem</li>\n\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">DispatchWorkItem</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"I'm work item\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<li>Closure</li>\n\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"I'm closure\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<h3 id=\"Thread\">Thread<a href=\"2019/09/20/grand-central-dispatch-part1#Thread\"></a></h3><p>Task æœƒåœ¨ Thread è¢«åŸ·è¡Œ<br>è€Œ Thread æ˜¯ç”±ç³»çµ±çš„ Thread Pool è² è²¬ç®¡ç†<br><strong>æ›´æ–° UI è¦åœ¨ Main Thread</strong></p>\n<h3 id=\"Queue\">Queue<a href=\"2019/09/20/grand-central-dispatch-part1#Queue\"></a></h3><p>ç¬¦åˆ First-in, First-out (<strong>FIFO</strong>), å…ˆé€²ä¸€å®šå…ˆå‡º</p>\n<div align=\"left\"><img src=\"/2019/09/20/grand-central-dispatch-part1/gcd1.jpeg\"></div>\n\n<p>å¯ä»¥è¯æƒ³æˆæ’éšŠçš„æƒ…æ³</p>\n<div align=\"left\"><img src=\"/2019/09/20/grand-central-dispatch-part1/gcd2.jpeg\"></div>\n\n<br>\n\n<p><strong>- - - - - - - - - - - - - -</strong></p>\n<br>\n\n<h1 id=\"Dispatch-Queue\"><u> <strong>Dispatch Queue</strong> </u><a href=\"2019/09/20/grand-central-dispatch-part1#Dispatch-Queue\"></a></h1><p>ä¸»è¦ç”¨æ–¼èª¿åº¦åŠæäº¤ Task åˆ° Thread å»åŸ·è¡Œ<br>è«‹æŠŠéšŠåˆ—çš„äººç•¶ä½œ Task</p>\n<div align=\"left\"><img src=\"/2019/09/20/grand-central-dispatch-part1/gcd3.jpeg\"></div>\n\n<p>GCD æä¾›å…©ç¨® Dispatch Queue, Serial Queue åŠ Concurrent Queue<br>å…©ç¨®ç‰¹æ€§ä¸å¤ªä¸€æ¨£<mark>, ä½†å…©è€…å…±åŒè™•æ˜¯çš†ç¬¦åˆ <strong>FIFO</strong> çš„ç‰¹æ€§</mark></p>\n<br>\n\n<h3 id=\"Serial-Queue\">Serial Queue<a href=\"2019/09/20/grand-central-dispatch-part1#Serial-Queue\"></a></h3><p>ä¸€æ¬¡åªæœƒåŸ·è¡Œä¸€å€‹ Task, <strong>æœƒç­‰åˆ°å‰ä¸€å€‹ Task åŸ·è¡Œå®Œæ‰æœƒåŸ·è¡Œä¸‹ä¸€å€‹</strong></p>\n<p>å› ç‚º Serial çš„ç‰¹æ€§, ç¢ºä¿ä¸€æ¬¡åªæœƒåŸ·è¡Œä¸€å€‹ Task, æ‰€ä»¥ç³»çµ±åªéœ€è¦æä¾›ä¸€å€‹ Thread å³å¯</p>\n<div align=\"left\"><img src=\"/2019/09/20/grand-central-dispatch-part1/gcd4.jpeg\"></div>\n\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> serialQueue = <span class=\"type\">DispatchQueue</span>(label: <span class=\"string\">\"serial\"</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">serialQueue.async &#123;</span><br><span class=\"line\">    sleep(<span class=\"number\">3</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"Task 1, Thread: \\(Thread.current)\"</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">serialQueue.async &#123;</span><br><span class=\"line\">    sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"Task 2, Thread: \\(Thread.current)\"</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">serialQueue.async &#123;</span><br><span class=\"line\">    sleep(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"Task 3, Thread: \\(Thread.current)\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-------------- Console log --------------</span><br><span class=\"line\">Task 1, Thread: &lt;NSThread: 0x600003369580&gt;&#123;number = 3, name = (null)&#125;</span><br><span class=\"line\">Task 2, Thread: &lt;NSThread: 0x600003369580&gt;&#123;number = 3, name = (null)&#125;</span><br><span class=\"line\">Task 3, Thread: &lt;NSThread: 0x600003369580&gt;&#123;number = 3, name = (null)&#125;</span><br></pre></td></tr></table></div></figure>\n\n<br>\n\n<h3 id=\"Concurrent-Queue\">Concurrent Queue<a href=\"2019/09/20/grand-central-dispatch-part1#Concurrent-Queue\"></a></h3><p>èˆ‡ Serial Queue ä¸åŒè™•, ç¬¬ä¸€å€‹ Task è¢«æäº¤å‡ºå»<br>ç¬¬äºŒå€‹ Task é¦¬ä¸Šè¢«æäº¤å‡ºå», å› ç‚ºæ™‚é–“å·®å¾ˆçŸ­<br>æ‰€ä»¥ Task çœ‹èµ·ä¾†æœƒå¹¾ä¹åŒæ™‚åŸ·è¡Œ<br>éœ€è¦å› æ‡‰å¤šå€‹ Task, æ‰€ä»¥ç³»çµ±æœƒæä¾›å¤šå€‹ Thread</p>\n<div align=\"left\"><img src=\"/2019/09/20/grand-central-dispatch-part1/gcd5.jpeg\"></div>\n\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> concurrentQueue = <span class=\"type\">DispatchQueue</span>(label: <span class=\"string\">\"concurrent\"</span>, attributes: .concurrent)</span><br><span class=\"line\"></span><br><span class=\"line\">concurrentQueue.async &#123;</span><br><span class=\"line\">    sleep(<span class=\"number\">3</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"Task 1, Thread: \\(Thread.current)\"</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">concurrentQueue.async &#123;</span><br><span class=\"line\">    sleep(<span class=\"number\">1</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"Task 2, Thread: \\(Thread.current)\"</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">concurrentQueue.async &#123;</span><br><span class=\"line\">    sleep(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"Task 3, Thread: \\(Thread.current)\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-------------- Console log --------------</span><br><span class=\"line\">Task 2, Thread: &lt;NSThread: 0x600002a7d780&gt;&#123;number = 6, name = (null)&#125;</span><br><span class=\"line\">Task 3, Thread: &lt;NSThread: 0x600002a7d940&gt;&#123;number = 7, name = (null)&#125;</span><br><span class=\"line\">Task 1, Thread: &lt;NSThread: 0x600002a72740&gt;&#123;number = 4, name = (null)&#125;</span><br></pre></td></tr></table></div></figure>\n\n<br>\n<br>\n\n<h4 id=\"ç™½è©±è§£é‡‹-Serial-Queue-åŠ-Concurrent-Queue-å·®åˆ¥\">ç™½è©±è§£é‡‹ Serial Queue åŠ Concurrent Queue å·®åˆ¥<a href=\"2019/09/20/grand-central-dispatch-part1#ç™½è©±è§£é‡‹-Serial-Queue-åŠ-Concurrent-Queue-å·®åˆ¥\"></a></h4><p>è¶…å•†æ’éšŠ (Queue), çµå¸³æ«ƒæª¯ (Thread)<br>å®¢äººçµå¸³ (Task)</p>\n<p><strong>Serial Queue</strong><br>ä¾åºæ’éšŠå¾Œ(FIFO), å› ç‚ºåªæœ‰ä¸€å€‹çµå¸³æ«ƒæª¯, æ‰€ä»¥å‰ä¸€å€‹å®¢äººçµå¸³å®Œæ‰æ›ä¸‹ä¸€ä½å®¢äºº</p>\n<p><strong>Concurrent Queue</strong><br>ä¾åºæ’éšŠå¾Œ(FIFO), å› ç‚ºæœ‰å¤šå€‹çµå¸³æ«ƒæª¯, æ‰€ä»¥ä¸ç”¨ç­‰å‰ä¸€å€‹å®¢äººçµå¸³å®Œ</p>\n<br>\n\n<p><strong>- - - - - - - - - - - - - -</strong></p>\n<br>\n\n<h1 id=\"å‰µå»º-Dispatch-Queue\"><u> <strong>å‰µå»º Dispatch Queue</strong> </u><a href=\"2019/09/20/grand-central-dispatch-part1#å‰µå»º-Dispatch-Queue\"></a></h1><h3 id=\"ç³»çµ±æä¾›-Dispatch-Queue\">ç³»çµ±æä¾› Dispatch Queue<a href=\"2019/09/20/grand-central-dispatch-part1#ç³»çµ±æä¾›-Dispatch-Queue\"></a></h3><ul>\n<li>Main Queue (Serial Queue)</li>\n</ul>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">DispatchQueue</span>.main</span><br></pre></td></tr></table></div></figure>\n\n<ul>\n<li>Global Queue (Concurrent Queue)<ul>\n<li>userInteractive</li>\n<li>userInitiated</li>\n<li>utility</li>\n<li>background</li>\n<li>default</li>\n<li>unspecified</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">DispatchQueue</span>.global(qos: .userInteractive)</span><br><span class=\"line\"><span class=\"type\">DispatchQueue</span>.global(qos: .userInitiated)</span><br><span class=\"line\"><span class=\"type\">DispatchQueue</span>.global(qos: .utility)</span><br><span class=\"line\"><span class=\"type\">DispatchQueue</span>.global(qos: .background)</span><br><span class=\"line\"><span class=\"type\">DispatchQueue</span>.global(qos: .<span class=\"keyword\">default</span>)</span><br><span class=\"line\"><span class=\"type\">DispatchQueue</span>.global(qos: .unspecified)</span><br></pre></td></tr></table></div></figure>\n\n<h3 id=\"è‡ªè¨‚Dispatch-Queue\">è‡ªè¨‚Dispatch Queue<a href=\"2019/09/20/grand-central-dispatch-part1#è‡ªè¨‚Dispatch-Queue\"></a></h3><p>é è¨­æ˜¯ <code>Serial Queue</code></p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">DispatchQueue</span>(label: <span class=\"string\">\"serial\"</span>)</span><br><span class=\"line\"><span class=\"type\">DispatchQueue</span>(label: <span class=\"string\">\"concurrent\"</span>, attributes: .concurrent)</span><br><span class=\"line\"><span class=\"type\">DispatchQueue</span>(label: <span class=\"string\">\"concurrent\"</span>, qos: .background, attributes: .concurrent)</span><br></pre></td></tr></table></div></figure>\n\n<br>\n\n<p><strong>- - - - - - - - - - - - - -</strong></p>\n<br>\n\n<h1 id=\"Synchronous-amp-Asynchronous\"><u> <strong>Synchronous &amp; Asynchronous</strong> </u><a href=\"2019/09/20/grand-central-dispatch-part1#Synchronous-amp-Asynchronous\"></a></h1><p>Dispatch Queue æäº¤ Task çš„æµç¨‹<br>é™¤äº†ä¸Šé¢æ‰€æåˆ°çš„ Serial Queue å’Œ Concurrent Queue<br>é‚„éœ€è¦æ­é… Synchronous æˆ– Asynchronous</p>\n<br>\n\n<li> Sync </li>\n\n<blockquote>\n<p>When a work item is executed synchronously with the sync<br>method, the program waits until execution finishes</p>\n</blockquote>\n<p>é˜»å¡ (block) ç•¶å‰æ‰€åœ¨ Thread, ç›´åˆ° Task åŸ·è¡Œå®Œç•¢, Task æœƒåœ¨ç•¶ä¸‹ Thread åŸ·è¡Œ<br><strong>å¦‚æœé˜»å¡åˆ° Main Thread, æœƒå°è‡´ UI å¡ä½ç›´åˆ° Task åŸ·è¡Œå®Œ</strong></p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">DispatchQueue</span>.global().sync &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> num <span class=\"keyword\">in</span> <span class=\"number\">1</span>...<span class=\"number\">5</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"â­•ï¸: \\(num), Thread: \\(Thread.current)\"</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> num <span class=\"keyword\">in</span> <span class=\"number\">1</span>...<span class=\"number\">5</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"âŒ: \\(num), Thread: \\(Thread.current)\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-------------- Console log --------------</span><br><span class=\"line\">â­•ï¸: 1, Thread: &lt;NSThread: 0x600001b568c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">â­•ï¸: 2, Thread: &lt;NSThread: 0x600001b568c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">â­•ï¸: 3, Thread: &lt;NSThread: 0x600001b568c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">â­•ï¸: 4, Thread: &lt;NSThread: 0x600001b568c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">â­•ï¸: 5, Thread: &lt;NSThread: 0x600001b568c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">âŒ: 1, Thread: &lt;NSThread: 0x600001b568c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">âŒ: 2, Thread: &lt;NSThread: 0x600001b568c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">âŒ: 3, Thread: &lt;NSThread: 0x600001b568c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">âŒ: 4, Thread: &lt;NSThread: 0x600001b568c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">âŒ: 5, Thread: &lt;NSThread: 0x600001b568c0&gt;&#123;number = 1, name = main&#125;</span><br></pre></td></tr></table></div></figure>\n\n<p>é€™æ™‚ä½ å¯ä»¥æƒ³åƒ, å‡ä½¿æˆ‘å€‘ä¸‹è¼‰ä¸€é¦–æ­Œè¦èŠ±ä¸€åˆ†é˜, ç”¨ Sync æœƒç™¼ç”Ÿä»€éº¼äº‹ ï¼Ÿ ğŸ¤—</p>\n<br>\n\n<li> Async </li>\n\n<blockquote>\n<p>When a work item is executed asynchronously with the async<br>method, the method call returns immediately</p>\n</blockquote>\n<p>ä¸æœƒé˜»å¡ (block) ç•¶å‰æ‰€åœ¨ Thread, æœƒè·³åˆ°å…¶ä»– Thread åŸ·è¡Œ<br>é€™ä¹Ÿæ˜¯æˆ‘å€‘å¸¸èªªçš„èƒŒæ™¯åŸ·è¡Œ</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">DispatchQueue</span>.global().async &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> num <span class=\"keyword\">in</span> <span class=\"number\">1</span>...<span class=\"number\">5</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"â­•ï¸: \\(num), Thread: \\(Thread.current)\"</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span> num <span class=\"keyword\">in</span> <span class=\"number\">1</span>...<span class=\"number\">5</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">\"âŒ: \\(num), Thread: \\(Thread.current)\"</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<figure class=\"highlight plain\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-------------- Console log --------------</span><br><span class=\"line\">âŒ: 1, Thread: &lt;NSThread: 0x60000032e1c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">â­•ï¸: 1, Thread: &lt;NSThread: 0x60000033c140&gt;&#123;number = 3, name = (null)&#125;</span><br><span class=\"line\">â­•ï¸: 2, Thread: &lt;NSThread: 0x60000033c140&gt;&#123;number = 3, name = (null)&#125;</span><br><span class=\"line\">âŒ: 2, Thread: &lt;NSThread: 0x60000032e1c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">âŒ: 3, Thread: &lt;NSThread: 0x60000032e1c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">â­•ï¸: 3, Thread: &lt;NSThread: 0x60000033c140&gt;&#123;number = 3, name = (null)&#125;</span><br><span class=\"line\">âŒ: 4, Thread: &lt;NSThread: 0x60000032e1c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">â­•ï¸: 4, Thread: &lt;NSThread: 0x60000033c140&gt;&#123;number = 3, name = (null)&#125;</span><br><span class=\"line\">âŒ: 5, Thread: &lt;NSThread: 0x60000032e1c0&gt;&#123;number = 1, name = main&#125;</span><br><span class=\"line\">â­•ï¸: 5, Thread: &lt;NSThread: 0x60000033c140&gt;&#123;number = 3, name = (null)&#125;</span><br></pre></td></tr></table></div></figure>\n\n<br>\n<br>\n\n<h4 id=\"ç™½è©±è§£é‡‹-Sync-åŠ-Async-å·®åˆ¥\">ç™½è©±è§£é‡‹ Sync åŠ Async å·®åˆ¥<a href=\"2019/09/20/grand-central-dispatch-part1#ç™½è©±è§£é‡‹-Sync-åŠ-Async-å·®åˆ¥\"></a></h4><p><strong>Sync</strong><br>å» 7-11 è²·å’–å•¡, åº—å“¡ç­‰å’–å•¡æ²–å¥½äº¤çµ¦ä½ æ‰èƒ½å¹«ä¸‹ä¸€ä½å®¢äººçµå¸³</p>\n<p><strong>Async</strong><br>å» 7-11 è²·å’–å•¡, åº—å“¡åœ¨ç­‰å•¡å•¡æ²–å¥½çš„é€™æ®µæ™‚æ©Ÿé», å¯ä»¥å¹«ä¸‹ä¸€ä½å®¢äººçµå¸³</p>\n<br>\n\n<p><strong>- - - - - - - - - - - - - -</strong></p>\n<br>\n\n\n<h1 id=\"æœ€çµ‚çµ„åˆ\"><u> <strong>æœ€çµ‚çµ„åˆ</strong> </u><a href=\"2019/09/20/grand-central-dispatch-part1#æœ€çµ‚çµ„åˆ\"></a></h1><p>æ­é…èµ·ä¾†æœƒæœ‰å››ç¨®çµ„åˆ, ç‰¹æ€§æœƒä¸å¤ªä¸€æ¨£</p>\n<p>Serial Queue - Sync<br>Concurrent Queue - Sync</p>\n<p>Serial Queue - Async    <strong>&lt;- è¼ƒå¸¸ç”¨</strong><br>Concurrent Queue - Async  <strong>&lt;- è¼ƒå¸¸ç”¨</strong></p>\n<p>ä¸ç®¡å“ªç¨® Dispatch Queue æ­é… Sync, æ•ˆæœéƒ½æ˜¯å·®ä¸å¤šçš„<br>éƒ½æ˜¯æœƒé˜»å¡ç•¶ä¸‹ Thread, é™¤éæœ‰ç‰¹æ®Šç‹€æ³, ä¸ç„¶å¾ˆå°‘ä½¿ç”¨</p>\n<p>æ­é… Async æ˜¯è¼ƒå¸¸ç”¨çš„, æœ€å¤§å„ªé»æ˜¯ä¸æœƒé˜»å¡ Thread<br>æ‰€ä»¥ä¹Ÿä¸æœƒæœ‰é˜»å¡ Main Thread é€ æˆ UI å¡ä½çš„ç¾è±¡</p>\n<br>\n\n<p><strong>- - - - - - - - - - - - - -</strong></p>\n<br>\n\n<h1 id=\"æ›´æ–°-UI\"><u> <strong>æ›´æ–° UI</strong> </u><a href=\"2019/09/20/grand-central-dispatch-part1#æ›´æ–°-UI\"></a></h1><p><mark><strong>æ›´æ–° UI, ä¸€å®šè¦åœ¨ Main Thread</strong></mark><br>æ‰€æœ‰åœ¨ Main Queue çš„ Task, çš†æœƒåœ¨ Main Thread è¢«åŸ·è¡Œ</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">DispatchQueue</span>.main.async &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Update UI</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n<br>\n\n<p><strong>â€» è«‹å‹¿åœ¨ Main Queue ä½¿ç”¨ Sync, æœƒé€ æˆ DeadLock</strong><br>ä¹‹å¾Œæ–‡ç« æœƒèªªæ˜ç‚ºä»€éº¼æœƒé€ æˆ DeadLock</p>\n<figure class=\"highlight swift\"><div><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">DispatchQueue</span>.main.sync &#123;</span><br><span class=\"line\">    <span class=\"comment\">// Cause deadlock</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></div></figure>\n\n","next":{"title":"[iOS] RxSwift ç°¡æ˜“ç­†è¨˜","link":"2019/07/16/rxswift"},"plink":"http://yoursite.com/2019/09/20/grand-central-dispatch-part1/","toc":[{"title":"<u> <strong>ä»€éº¼æ˜¯ GCD ?</strong> </u>","id":"ä»€éº¼æ˜¯-GCD","index":"1"},{"title":"<u> <strong>Dispatch Queue</strong> </u>","id":"Dispatch-Queue","index":"2"},{"title":"<u> <strong>å‰µå»º Dispatch Queue</strong> </u>","id":"å‰µå»º-Dispatch-Queue","index":"3"},{"title":"<u> <strong>Synchronous &amp; Asynchronous</strong> </u>","id":"Synchronous-amp-Asynchronous","index":"4"},{"title":"<u> <strong>æœ€çµ‚çµ„åˆ</strong> </u>","id":"æœ€çµ‚çµ„åˆ","index":"5"},{"title":"<u> <strong>æ›´æ–° UI</strong> </u>","id":"æ›´æ–°-UI","index":"6"}]}